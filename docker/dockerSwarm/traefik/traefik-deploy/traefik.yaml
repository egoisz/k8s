version: "3.5"
services:
  traefik:
    image: traefik:v2.5
    networks:
      - test-net
    ports:
      - mode: host
        protocol: tcp
        published: 80
        target: 80
      - mode: host
        protocol: tcp
        published: 443
        target: 443
      - mode: host
        protocol: tcp
        published: 8080
        target: 8080
      #- 80:80
      #- 443:443
      #- 8080:8080
    volumes:
      - /root/traefik/config.yaml:/etc/traefik/traefik.yml
      - /root/traefik/dynamic:/etc/traefik/dynamic
      - /root/traefik/certs:/etc/traefik/certs
      - /etc/localtime:/etc/localtime:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
    deploy:
      replicas: 1

      # 添加约束条件
      placement:
        constraints:
          - node.labels.role==master
      update_config:
        parallelism: 2
        delay: 10s
      labels:
        - traefik.enable=false
        #- traefik.http.services.traefik.loadbalancer.server.port=80
networks:
  test-net:
    external:
      name: "test_test-net"

